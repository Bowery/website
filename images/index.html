---
layout: default
title: Bowery - Images
name: images
---

<button href="#" class="logo" data-coffin="toggle"></button>
<div class="outer-header">
  <div class="content-container header images">
    <div class="content">
      <h1>images</h1>
    </div>
    <div class="content">
      <p>Bowery is a limitless development environment. Run your application in seconds no matter the operating system, programming language, database, or other dependencies. We're dedicated to making every stack easy to use.</p>
    </div>
  </div>
</div>
<div class="search-box">
  <input type="text" class="search-input" id="search">
</div>
<div class="content-container">
  <ul class="images-list"></ul>
</div>
<div class="modal-overlay">
  <div class="modal-content" id="modal"></div>
</div>
<script>
  // Global like Wayne Enterprises
  var xhr = new XMLHttpRequest()
  var list = document.querySelector('.images-list')
  var modal = document.getElementById('modal')
  var modalIsOpen = false
  var environments

  // try a native matchesSelector on a selector with an element
  function matchesSelector(element, selector) {
      var matcher = element.matchesSelector || element.mozMatchesSelector || element.webkitMatchesSelector || element.oMatchesSelector
      return matcher && matcher.call(element, selector);
  }

  // detect the closest element based on a selector. For simple delegation.
  function closest (element, selector) {
    while (element && !matchesSelector(element, selector)) {
        element = element.parentNode;
    }
    return element;
  }

  // Unrelated to coffin. Opens image info modal
  function openImageModal (id) {
    var image = environments.filter(function (e) {
      return e.id == id
    })[0]
    modal.innerHTML = [
      '<span class="modal-exit"></span>',
      '<h1>{name}</h1>',
      '<div class="description">',
        '<p>{description}</p>',
      '</div>',
      '<div class="data">',
        '<h3>Data</h3>',
        '<dl>',
          '<dt>Downloads</dt>',
          '<dd>{downloadCount}</dd>',
        '</dl>',
      '</div>'
    ].join('')
     .replace('{name}', image.name)
     .replace('{description}', image.description)
     .replace('{downloadCount}', image.downloadCount)

    var overlay = document.querySelector('.modal-overlay')
    overlay.style.display = 'block'
    overlay.style.backgroundColor = "rgba(255, 255, 255, 0.8)"
    modalIsOpen = true

    var exit = document.getElementsByClassName('modal-exit')[0]
    exit.onclick = function(e) {
      closeImageModal()
    }
  }

  // Unrelated to coffin. Closes image info modal
  function closeImageModal () {
    var overlay = document.querySelector('.modal-overlay')
    overlay.style.backgroundColor = "rgba(255, 255, 255, 0)";
    overlay.style.display = 'none'
    modalIsOpen = false
  }

  // Renders images html
  function renderImages(images) {
    return images.map(function (img) {
      if (!img.name) return ""

      return ['<li class="image-container">',
                 '<button class="btn image-btn" data-image="{id}">',
                   '<img class="image-logo" src="/static/image-logo.png">',
                   '<h4 class="image-title">{name}</h4>',
                   '<p class="image-description">{description}</p>',
                 '</button>',
               '</li>'].join('')
                       .replace('{id}', img.id)
                       .replace('{name}', img.name)
                       .replace('{description}', img.description)
    }).join('')
  }

  function searchImages(query) {
    xhr.abort()
    xhr.onload = function () {
      list.innerHTML = ""
      var response = JSON.parse(this.responseText)
      if (response.status == "found")
        list.innerHTML = renderImages(response.environments)

      // set to global so we can use it in the modal
      environments = response.environments
    }
    xhr.open("get", "http://kenmare.io/environments?query=" + query, true)
    xhr.send()
  }

  function loadDefault() {
    searchImages('default')
  }

  document.getElementById('search').addEventListener('keyup', function (e) {
    var query = e.target.value
    if (query == '') query = 'default'
    searchImages(query)
  })

  document.addEventListener('click', function (e) {
    var el
    if (!modalIsOpen && (el = closest(e.target, '[data-image]')))
      return openImageModal(el.dataset.image)

    if (modalIsOpen && closest(e.target, '.modal-overlay'))
      return closeImageModal()
  })

  loadDefault()
</script>
